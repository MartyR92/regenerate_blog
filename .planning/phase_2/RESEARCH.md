# Research: Phase 2 - Pipeline Integration

## 1. Current Workflow Sequence
1. **Research Agent**: Scrapes data -> `context/research-queue.json`.
2. **Writer Agent**: Reads research -> `_drafts/*.md`.
3. **Editor Agent**: (Triggered by push to `_drafts/**`) -> Creates PR with inline comments.
4. **Visual Agent**: (Triggered by PR from `editor/` branch) -> Adds hero image from Unsplash.
5. **Staging Agent**: (Triggered by PR labels) -> Deploys preview, runs Lighthouse, reports to PR.

## 2. Image Agent Integration
- **Trigger**: The `image-agent` should run **after** `writer-agent` but **before** `editor-agent`.
- **Mechanism**: Use `workflow_run` on `Writer Agent` completion.
- **Action**: Runs `scripts/image.py`.
- **Output**: Modifies the Markdown file in `_drafts/`. 
- **Sequential Safety**: Since `editor-agent` triggers on `push` to `_drafts/**`, the `image-agent` must commit its changes back to the branch. This will naturally trigger `editor-agent` for the final combined review.

## 3. Designer Agent Integration
- **Location**: Inside `staging-agent.yml`.
- **Mechanism**: New step after "Prepare Drafts for Preview".
- **Action**: Runs `scripts/designer.py`.
- **Reporting**: The `design_report.md` generated by the script needs to be read and appended to the `Post PR Comment` step in `staging-agent.yml` using `actions/github-script`.

## 4. Conflict Analysis
- **Visual Agent**: Currently adds images from Unsplash. `image-agent` adds technical diagrams via Gemini 3.1. These are complementary. `visual.py` checks for `featureImage` in front matter; `image.py` adds inline diagrams. No conflict.
- **Permissions**: Both new steps require `contents: write` to commit images/markdown or `pull-requests: write` for comments.
